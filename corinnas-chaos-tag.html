<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Corinnas Chaos-Tag</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            color-scheme: dark light;
        }

        body {
            margin: 0;
            padding: 0;
            background: #111;
            color: #f5f5f5;
        }

        #app {
            max-width: 700px;
            margin: 0 auto;
            padding: 16px;
        }

        h1 {
            font-size: 1.4rem;
            margin-top: 0;
            text-align: center;
        }

        #story {
            border-radius: 8px;
            border: 1px solid #444;
            padding: 12px;
            min-height: 220px;
            max-height: 320px;
            overflow-y: auto;
            white-space: pre-line;
            font-size: 0.95rem;
            background: #181818;
        }

        .buttons {
            margin-top: 12px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        button {
            border-radius: 999px;
            border: none;
            padding: 10px 14px;
            font-size: 0.95rem;
            cursor: pointer;
            background: #2563eb;
            color: #fff;
        }

        button.secondary {
            background: #374151;
        }

        button:disabled {
            opacity: 0.5;
            cursor: default;
        }

        #stats {
            margin-top: 10px;
            font-size: 0.9rem;
            color: #d1d5db;
        }

        #shareBtn,
        #copyBtn,
        #downloadBtn {
            width: 100%;
            margin-top: 8px;
        }

        @media (prefers-color-scheme: light) {
            body { background: #f3f4f6; color: #111827; }
            #story { background: #ffffff; border-color: #d1d5db; }
            button { background: #2563eb; }
            button.secondary { background: #e5e7eb; color: #111827; }
        }
    </style>
</head>
<body>
<div id="app">
    <h1>Corinnas Chaos-Tag</h1>

    <div id="story"></div>

    <div class="buttons">
        <button id="choice1"></button>
        <button id="choice2"></button>
        <button id="choice3"></button>
    </div>

    <div id="stats"></div>

    <button id="shareBtn" class="secondary">Ergebnis teilen (Discord / WhatsApp â€¦)</button>
    <button id="copyBtn" class="secondary">Ergebnis in Zwischenablage kopieren</button>
    <button id="downloadBtn" class="secondary">Ergebnis als TXT herunterladen</button>
</div>

<script>
    const storyEl = document.getElementById("story");
    const choice1Btn = document.getElementById("choice1");
    const choice2Btn = document.getElementById("choice2");
    const choice3Btn = document.getElementById("choice3");
    const statsEl = document.getElementById("stats");
    const shareBtn = document.getElementById("shareBtn");
    const copyBtn = document.getElementById("copyBtn");
    const downloadBtn = document.getElementById("downloadBtn");

    const state = {
        coolness: 0,
        peinlichkeit: 0,
        sympathie: 0,
        energie: 5,
        log: [],
        currentScene: 0, // 0 Intro, 1-4 Szenen, -1 Ende
        gameOver: false
    };

    function resetState() {
        state.coolness = 0;
        state.peinlichkeit = 0;
        state.sympathie = 0;
        state.energie = 5;
        state.log = [];
        state.currentScene = 0;
        state.gameOver = false;
    }

    function statsString(prefix = "Werte: ") {
        return `${prefix}Coolness=${state.coolness}, Peinlichkeit=${state.peinlichkeit}, Sympathie=${state.sympathie}, Energie=${state.energie}`;
    }

    function updateStats() {
        statsEl.textContent = statsString();
    }

    function checkGameOver() {
        if (state.peinlichkeit >= 8 || state.energie <= -1) {
            state.gameOver = true;
        }
    }

    function showIntro() {
        resetState();
        shareBtn.disabled = true;
        copyBtn.disabled = true;
        downloadBtn.disabled = true;

        storyEl.textContent =
`=====================================
      CORINNAS CHAOS-TAG
      Ein kleines Textadventure
=====================================

Du spielst Corinna an einem vÃ¶llig normalen Tag.
NatÃ¼rlich wird dieser Tag ALLES â€“ nur nicht normal.

Tippe auf "Spiel starten", um zu beginnen.`;

        choice1Btn.textContent = "Spiel starten";
        choice1Btn.style.display = "block";

        choice2Btn.style.display = "none";
        choice3Btn.style.display = "none";

        updateStats();
    }

    function showScene1() {
        state.currentScene = 1;
        storyEl.textContent =
`SZENE 1 â€“ Der Morgen danach
---------------------------
Corinna reiÃŸt die Augen auf.
Ihr Handy zeigt: 07:43. Der Wecker war auf 06:30 gestellt â€“ ups.
Sie muss um 08:00 irgendwo sein. Irgendwo sehr Wichtiges.
Nurâ€¦ ihr Gehirn hat noch Ladebalken.

Was macht Corinna zuerst?`;

        choice1Btn.textContent = "1) Handy checken â€“ vielleicht steht da, wo sie hin muss.";
        choice2Btn.textContent = "2) Ins Bad sprinten â€“ Hauptsache nicht komplett zerstÃ¶rt aussehen.";
        choice3Btn.textContent = "3) Snooze drÃ¼cken und hoffen, dass es nicht so wichtig ist.";

        choice1Btn.style.display = "block";
        choice2Btn.style.display = "block";
        choice3Btn.style.display = "block";

        state.log.push("SZENE 1 â€“ Der Morgen danach");
        state.log.push("Frage: Was macht Corinna zuerst?");
    }

    function showScene2() {
        state.currentScene = 2;
        storyEl.textContent =
`SZENE 2 â€“ Der Bus-Moment
------------------------
Corinna sitzt im Ã¼berfÃ¼llten Bus.
PlÃ¶tzlich fÃ¤ngt ihre Bluetooth-Box im Rucksack an zu spielen â€“
natÃ¼rlich ein ultra-kitschiges Liebeslied auf voller LautstÃ¤rke.
Alle schauen sie an.

Wie reagiert sie?`;

        choice1Btn.textContent = "1) 'Ja, das ist mein Song. Wer mitsingen will, nur zu!'";
        choice2Btn.textContent = "2) Hektisch alles ausschalten und hoffen, dass niemand sie erkennt.";
        choice3Btn.textContent = "3) So tun, als wÃ¤re der Rucksack nicht ihrer.";

        state.log.push("SZENE 2 â€“ Der Bus-Moment");
        state.log.push("Frage: Wie reagiert sie im Bus mit der lauten Musik?");
    }

    function showScene3() {
        state.currentScene = 3;
        storyEl.textContent =
`SZENE 3 â€“ Der falsche Chat
---------------------------
In einer Pause zÃ¼ckt Corinna ihr Handy.
Sie schreibt ihrer besten Freundin und lÃ¤stert kurz Ã¼ber jemanden.
Die Nachricht landet aus Versehen bei GENAU dieser Person.

Wie rettet sie die Situation?`;

        choice1Btn.textContent = "1) 'War nur ein Test, ob du mitliest ðŸ˜…'";
        choice2Btn.textContent = "2) Ehrlich entschuldigen.";
        choice3Btn.textContent = "3) Handy aus, ignorieren, so tun als wÃ¤re nie was passiert.";

        state.log.push("SZENE 3 â€“ Der falsche Chat");
        state.log.push("Frage: Wie rettet sie die Situation?");
    }

    function showScene4() {
        state.currentScene = 4;
        storyEl.textContent =
`SZENE 4 â€“ Der Snack-Unfall
---------------------------
In der Pause trinkt Corinna etwas und erzÃ¤hlt eine lustige Geschichte.
Ein Witz ist so gut, dass ihr GetrÃ¤nk aus der Nase kommt.
Perfekter Slow-Motion-Moment. Alle sehen es.

Wie reagiert sie?`;

        choice1Btn.textContent = "1) Laut mitlachen, eine Show draus machen.";
        choice2Btn.textContent = "2) Aufs Klo rennen und sich verstecken.";
        choice3Btn.textContent = "3) Jemand anderem die Schuld geben: 'Du hast mich zum Lachen gebracht!'";

        state.log.push("SZENE 4 â€“ Der Snack-Unfall");
        state.log.push("Frage: Wie reagiert sie nach dem GetrÃ¤nk-aus-der-Nase-Moment?");
    }

    function showEnd() {
        state.currentScene = -1;
        shareBtn.disabled = false;
        copyBtn.disabled = false;
        downloadBtn.disabled = false;

        const lines = [];
        lines.push("===== TAGESFAZIT =====");
        lines.push(statsString());
        lines.push("");

        let endingTitle;
        let endingText;

        if (state.peinlichkeit >= 8) {
            endingTitle = "ULTRA-CRINGE-ENDE";
            endingText = [
                "Jemand hat Corinnas Tag als Cringe-Compilation",
                "auf TikTok hochgeladen. 2 Millionen Aufrufe.",
                "Titel: 'Die KÃ¶nigin des Chaos'."
            ];
        } else if (state.energie <= -1) {
            endingTitle = "BURNOUT-ENDE";
            endingText = [
                "Corinna ist so durch, dass sie ab einem gewissen Punkt",
                "nur noch auf Autopilot peinliche Dinge getan hat.",
                "Vielleicht morgen ein bisschen weniger Drama..."
            ];
        } else {
            const score = state.coolness + state.sympathie - state.peinlichkeit;

            if (score >= 5 && state.peinlichkeit <= 3) {
                endingTitle = "PERFEKTES ENDE";
                endingText = [
                    "Trotz aller peinlichen Momente hat Corinna ihren Tag",
                    "mit Style, Humor und Sympathie gemeistert.",
                    "Aus den Szenen werden eher Insider-Witze als Trauma."
                ];
            } else if (score >= 0) {
                endingTitle = "OKAY-ENDE";
                endingText = [
                    "Es war chaotisch, es war peinlich, aber hey:",
                    "in ein paar Wochen erinnert sich niemand mehr so richtig dran.",
                    "AuÃŸer Corinna. Vielleicht."
                ];
            } else {
                endingTitle = "MEH-ENDE";
                endingText = [
                    "Es hÃ¤tte besser laufen kÃ¶nnen.",
                    "Aber man wÃ¤chst ja bekanntlich an seinen Cringe-Momenten.",
                    "Vielleicht ist morgen ein bisschen weniger Katastrophe."
                ];
            }
        }

        lines.push(endingTitle);
        lines.push("-".repeat(endingTitle.length));
        lines.push(...endingText);

        storyEl.textContent = lines.join("\n");

        // auch ins Log
        state.log.push("===== TAGESFAZIT =====");
        state.log.push(statsString());
        state.log.push("");
        state.log.push(endingTitle);
        endingText.forEach(l => state.log.push(l));

        choice1Btn.textContent = "Nochmal spielen";
        choice2Btn.style.display = "none";
        choice3Btn.style.display = "none";
    }

    function handleScene1(choice) {
        if (choice === 1) {
            state.energie -= 1;
            state.coolness -= 1;
            state.peinlichkeit += 1;
            state.sympathie += 1;
            state.log.push("Antwort: 1) Handy checken.");
        } else if (choice === 2) {
            state.energie -= 2;
            state.coolness += 1;
            state.peinlichkeit -= 1;
            state.log.push("Antwort: 2) Ins Bad sprinten.");
        } else if (choice === 3) {
            state.energie += 1;
            state.coolness -= 2;
            state.peinlichkeit += 2;
            state.log.push("Antwort: 3) Snooze drÃ¼cken.");
        }
        state.log.push(statsString("Werte nach Szene 1: "));
        state.log.push("");
    }

    function handleScene2(choice) {
        if (choice === 1) {
            state.coolness += 2;
            state.sympathie += 1;
            state.peinlichkeit += 1;
            state.energie -= 1;
            state.log.push("Antwort: 1) 'Ja, das ist mein Song.'");
        } else if (choice === 2) {
            state.peinlichkeit += 2;
            state.coolness -= 1;
            state.energie -= 1;
            state.log.push("Antwort: 2) Hektisch alles ausschalten.");
        } else if (choice === 3) {
            state.sympathie -= 2;
            state.peinlichkeit += 1;
            state.coolness += 1;
            state.log.push("Antwort: 3) So tun, als wÃ¤re der Rucksack nicht ihrer.");
        }
        state.log.push(statsString("Werte nach Szene 2: "));
        state.log.push("");
    }

    function handleScene3(choice) {
        if (choice === 1) {
            state.coolness += 1;
            state.peinlichkeit += 2;
            state.sympathie -= 1;
            state.log.push("Antwort: 1) 'War nur ein Test ðŸ˜…'");
        } else if (choice === 2) {
            state.sympathie += 2;
            state.peinlichkeit += 1;
            state.coolness -= 1;
            state.log.push("Antwort: 2) Ehrlich entschuldigen.");
        } else if (choice === 3) {
            state.peinlichkeit += 1;
            state.sympathie -= 2;
            state.energie += 1;
            state.log.push("Antwort: 3) Handy aus, ignorieren.");
        }
        state.log.push(statsString("Werte nach Szene 3: "));
        state.log.push("");
    }

    function handleScene4(choice) {
        if (choice === 1) {
            state.coolness += 2;
            state.sympathie += 2;
            state.peinlichkeit += 1;
            state.energie -= 1;
            state.log.push("Antwort: 1) Mitlachen, Show draus machen.");
        } else if (choice === 2) {
            state.peinlichkeit += 1;
            state.energie += 2;
            state.sympathie -= 1;
            state.log.push("Antwort: 2) Aufs Klo rennen.");
        } else if (choice === 3) {
            state.sympathie -= 2;
            state.peinlichkeit -= 1;
            state.coolness += 1;
            state.log.push("Antwort: 3) Jemand anderem die Schuld geben.");
        }
        state.log.push(statsString("Werte nach Szene 4: "));
        state.log.push("");
    }

    function handleChoice(choice) {
        if (state.currentScene === 0) {
            showScene1();
            updateStats();
            return;
        }

        if (state.currentScene === -1) {
            // Neustart
            showIntro();
            return;
        }

        if (state.currentScene === 1) {
            handleScene1(choice);
            checkGameOver();
            if (state.gameOver) {
                showEnd();
                updateStats();
                return;
            }
            showScene2();
        } else if (state.currentScene === 2) {
            handleScene2(choice);
            checkGameOver();
            if (state.gameOver) {
                showEnd();
                updateStats();
                return;
            }
            showScene3();
        } else if (state.currentScene === 3) {
            handleScene3(choice);
            checkGameOver();
            if (state.gameOver) {
                showEnd();
                updateStats();
                return;
            }
            showScene4();
        } else if (state.currentScene === 4) {
            handleScene4(choice);
            checkGameOver();
            showEnd();
        }

        updateStats();
    }

    function buildResultText() {
        const lines = [];
        lines.push("Corinnas Chaos-Tag - Ergebnis");
        lines.push("Erstellt am: " + new Date().toLocaleString());
        lines.push("");
        state.log.forEach(l => lines.push(l));
        return lines.join("\n");
    }

    async function shareResult() {
        const text = buildResultText();
        if (navigator.share) {
            try {
                await navigator.share({
                    title: "Corinnas Chaos-Tag Ergebnis",
                    text: text
                });
            } catch (e) {
                // abgebrochen oder Fehler
                console.log(e);
            }
        } else {
            alert("Dein Browser unterstÃ¼tzt die Teilen-Funktion nicht direkt. Nutze 'kopieren' oder 'TXT herunterladen'.");
        }
    }

    async function copyResult() {
        const text = buildResultText();
        if (navigator.clipboard && navigator.clipboard.writeText) {
            try {
                await navigator.clipboard.writeText(text);
                alert("Ergebnis wurde in die Zwischenablage kopiert.");
            } catch (e) {
                alert("Kopieren nicht mÃ¶glich. Vielleicht im Browser blockiert.");
            }
        } else {
            alert("Kopieren wird von diesem Browser nicht unterstÃ¼tzt.");
        }
    }

    function downloadResult() {
        const text = buildResultText();
        const blob = new Blob([text], { type: "text/plain" });
        const url = URL.createObjectURL(blob);

        const now = new Date();
        const pad = n => n.toString().padStart(2, "0");
        const fileName = `CorinnasChaosTag_${now.getFullYear()}${pad(now.getMonth() + 1)}${pad(now.getDate())}_${pad(now.getHours())}${pad(now.getMinutes())}${pad(now.getSeconds())}.txt`;

        const a = document.createElement("a");
        a.href = url;
        a.download = fileName;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }

    // Event-Handler
    choice1Btn.addEventListener("click", () => handleChoice(1));
    choice2Btn.addEventListener("click", () => handleChoice(2));
    choice3Btn.addEventListener("click", () => handleChoice(3));
    shareBtn.addEventListener("click", shareResult);
    copyBtn.addEventListener("click", copyResult);
    downloadBtn.addEventListener("click", downloadResult);

    // Start
    showIntro();
</script>
</body>
</html>
